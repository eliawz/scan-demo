<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Security Scan Demo</title>
  <style>
    body { font-family: Arial, sans-serif; background:#0b1020; color:#e5e7eb; display:flex; justify-content:center; padding:40px;}
    .card { width: 420px; background:#111a33; border:1px solid #1f2a4a; border-radius:16px; padding:20px; box-shadow: 0 10px 30px rgba(0,0,0,.35);}
    h1 { font-size:18px; margin:0 0 12px;}
    input { width:100%; padding:12px; margin:8px 0; border-radius:12px; border:1px solid #223055; background:#0b1020; color:#e5e7eb;}
    button { width:100%; padding:12px; border-radius:12px; border:0; background:#3b82f6; color:white; font-weight:700; cursor:pointer; margin-top:8px;}
    button:disabled { opacity:.6; cursor:not-allowed;}
    .small { font-size:12px; color:#9ca3af; margin-top:10px; line-height:1.4;}
    .barwrap { margin-top:14px; background:#0b1020; border:1px solid #223055; border-radius:999px; overflow:hidden; height:12px; display:none;}
    .bar { height:100%; width:0%; background:#22c55e; transition:width .18s;}
    .status { margin-top:10px; font-size:13px; color:#cbd5e1; display:none;}
    .ok { color:#22c55e; }
    .err { color:#ef4444; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Instant External Security Scan (Demo)</h1>

    <form id="scanForm">
      <input name="name" placeholder="Business name" required />
      <input name="domain" placeholder="Domain (example.com)" required />
      <input name="report_email" placeholder="Email to receive report" required />
      <button id="btn" type="submit">Scan</button>
    </form>

    <div class="barwrap" id="barwrap"><div class="bar" id="bar"></div></div>
    <div class="status" id="status"></div>

    <div class="small">
      External checks only (no credentials required). You’ll receive a report by email.
    </div>
  </div>

<script>
  // ✅ Replace with your n8n Cloud *production* webhook URL:
  const N8N_WEBHOOK_URL = "https://YOUR-N8N-CLOUD/webhook/scan";

  const form = document.getElementById("scanForm");
  const btn = document.getElementById("btn");
  const barwrap = document.getElementById("barwrap");
  const bar = document.getElementById("bar");
  const statusEl = document.getElementById("status");

  function showStatus(msg, cls="") {
    statusEl.style.display = "block";
    statusEl.className = "status " + cls;
    statusEl.textContent = msg;
  }

  function fakeProgressFast() {
    barwrap.style.display = "block";
    bar.style.width = "0%";

    const steps = [
      ["Validating domain…", 20],
      ["Discovering attack surface…", 55],
      ["Checking DNS/email posture…", 72],
      ["Checking credential exposure…", 86],
      ["Generating report…", 96],
      ["Sending email…", 100],
    ];

    let i = 0;
    showStatus("Starting scan…");

    const timer = setInterval(() => {
      if (i >= steps.length) return clearInterval(timer);
      const [msg, pct] = steps[i++];
      bar.style.width = pct + "%";
      showStatus(msg);
    }, 250); // FAST: ~1.5s total

    return timer;
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    btn.disabled = true;

    const payload = {
      name: form.name.value.trim(),
      domain: form.domain.value.trim(),
      report_email: form.report_email.value.trim()
    };

    const timer = fakeProgressFast();

    try {
      const res = await fetch(N8N_WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const data = await res.json().catch(() => ({}));

      if (!res.ok) {
        clearInterval(timer);
        showStatus("Scan failed. Please try again.", "err");
        btn.disabled = false;
        return;
      }

      bar.style.width = "100%";
      showStatus(data.message || "Scan started. Report will arrive shortly.", "ok");

    } catch (err) {
      clearInterval(timer);
      showStatus("Network error. Check webhook URL.", "err");
    }

    btn.disabled = false;
  });
</script>

</body>
</html>
